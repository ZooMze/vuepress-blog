<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2021-Q2 技术分享与探讨 | ZooMze&#39;s World</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/vuepress-blog/favicon.ico">
    <meta name="description" content="Code your dream!">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="preload" href="/vuepress-blog/assets/css/0.styles.6f95b769.css" as="style"><link rel="preload" href="/vuepress-blog/assets/js/app.08ec8abf.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/4.98f06f74.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/1.f7bebc45.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/15.c487e23b.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/js/10.e545f867.js"><link rel="prefetch" href="/vuepress-blog/assets/js/11.700e9c7c.js"><link rel="prefetch" href="/vuepress-blog/assets/js/12.463bbefb.js"><link rel="prefetch" href="/vuepress-blog/assets/js/13.55b3a4b4.js"><link rel="prefetch" href="/vuepress-blog/assets/js/14.2ce287c6.js"><link rel="prefetch" href="/vuepress-blog/assets/js/16.5348eedf.js"><link rel="prefetch" href="/vuepress-blog/assets/js/17.272ab600.js"><link rel="prefetch" href="/vuepress-blog/assets/js/18.035ae0e2.js"><link rel="prefetch" href="/vuepress-blog/assets/js/19.29f02bf1.js"><link rel="prefetch" href="/vuepress-blog/assets/js/20.145fd3fb.js"><link rel="prefetch" href="/vuepress-blog/assets/js/21.d2352f77.js"><link rel="prefetch" href="/vuepress-blog/assets/js/22.8d719d54.js"><link rel="prefetch" href="/vuepress-blog/assets/js/23.810c886a.js"><link rel="prefetch" href="/vuepress-blog/assets/js/24.ef153a67.js"><link rel="prefetch" href="/vuepress-blog/assets/js/25.c45a3e93.js"><link rel="prefetch" href="/vuepress-blog/assets/js/26.a03a543c.js"><link rel="prefetch" href="/vuepress-blog/assets/js/27.8acf436f.js"><link rel="prefetch" href="/vuepress-blog/assets/js/28.8bf23c55.js"><link rel="prefetch" href="/vuepress-blog/assets/js/29.452ac1a0.js"><link rel="prefetch" href="/vuepress-blog/assets/js/30.739945eb.js"><link rel="prefetch" href="/vuepress-blog/assets/js/31.4af469a5.js"><link rel="prefetch" href="/vuepress-blog/assets/js/32.b64452db.js"><link rel="prefetch" href="/vuepress-blog/assets/js/33.11da4150.js"><link rel="prefetch" href="/vuepress-blog/assets/js/34.e080b716.js"><link rel="prefetch" href="/vuepress-blog/assets/js/35.6a5a98e6.js"><link rel="prefetch" href="/vuepress-blog/assets/js/36.32fe7d81.js"><link rel="prefetch" href="/vuepress-blog/assets/js/37.c273b5ad.js"><link rel="prefetch" href="/vuepress-blog/assets/js/38.dca5dd05.js"><link rel="prefetch" href="/vuepress-blog/assets/js/39.085ea94d.js"><link rel="prefetch" href="/vuepress-blog/assets/js/40.b53dd35f.js"><link rel="prefetch" href="/vuepress-blog/assets/js/41.859ba097.js"><link rel="prefetch" href="/vuepress-blog/assets/js/42.0e269f5a.js"><link rel="prefetch" href="/vuepress-blog/assets/js/43.f1f6284c.js"><link rel="prefetch" href="/vuepress-blog/assets/js/44.031143f5.js"><link rel="prefetch" href="/vuepress-blog/assets/js/45.e3bcbbad.js"><link rel="prefetch" href="/vuepress-blog/assets/js/46.9a90643e.js"><link rel="prefetch" href="/vuepress-blog/assets/js/47.902ec5d5.js"><link rel="prefetch" href="/vuepress-blog/assets/js/48.92eb7159.js"><link rel="prefetch" href="/vuepress-blog/assets/js/49.d7d584c6.js"><link rel="prefetch" href="/vuepress-blog/assets/js/5.90927284.js"><link rel="prefetch" href="/vuepress-blog/assets/js/50.95c0f153.js"><link rel="prefetch" href="/vuepress-blog/assets/js/51.fb8a6800.js"><link rel="prefetch" href="/vuepress-blog/assets/js/52.fc33693e.js"><link rel="prefetch" href="/vuepress-blog/assets/js/53.dc66da3b.js"><link rel="prefetch" href="/vuepress-blog/assets/js/6.0964f437.js"><link rel="prefetch" href="/vuepress-blog/assets/js/7.fc1177d9.js"><link rel="prefetch" href="/vuepress-blog/assets/js/8.9b0b183f.js"><link rel="prefetch" href="/vuepress-blog/assets/js/9.c0ad6d4b.js"><link rel="prefetch" href="/vuepress-blog/assets/js/vendors~flowchart.88969470.js">
    <link rel="stylesheet" href="/vuepress-blog/assets/css/0.styles.6f95b769.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-19557b78><div data-v-19557b78><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-19557b78 data-v-19557b78><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-19557b78 data-v-19557b78><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>ZooMze's World</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>ZooMze</span>
            
          <span data-v-64685f0e>2018 - </span>
          2021
        </a></span></div></div> <div class="hide" data-v-19557b78><header class="navbar" data-v-19557b78><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-blog/" class="home-link router-link-active"><img src="/vuepress-blog/logo.png" alt="ZooMze's World" class="logo"> <span class="site-name">ZooMze's World</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress-blog/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/categories/基础/" class="nav-link"><i class="iconfont undefined"></i>
  基础
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/categories/备忘/" class="nav-link"><i class="iconfont undefined"></i>
  备忘
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/categories/教程/" class="nav-link"><i class="iconfont undefined"></i>
  教程
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/categories/扩展/" class="nav-link"><i class="iconfont undefined"></i>
  扩展
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/categories/框架/" class="nav-link"><i class="iconfont undefined"></i>
  框架
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/categories/组件/" class="nav-link"><i class="iconfont undefined"></i>
  组件
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/categories/季度分享/" class="nav-link"><i class="iconfont undefined"></i>
  季度分享
</a></li></ul></div></div><div class="nav-item"><a href="/vuepress-blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/vuepress-blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时光轴
</a></div><div class="nav-item"><a href="https://github.com/ZooMze" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-19557b78></div> <aside class="sidebar" data-v-19557b78><div class="personal-info-wrapper" data-v-042e23d4><img src="/vuepress-blog/avatar.png" alt="author-avatar" class="personal-img" data-v-042e23d4> <h3 class="name" data-v-042e23d4>
    ZooMze
  </h3> <div class="num" data-v-042e23d4><div data-v-042e23d4><h3 data-v-042e23d4>35</h3> <h6 data-v-042e23d4>Article</h6></div> <div data-v-042e23d4><h3 data-v-042e23d4>23</h3> <h6 data-v-042e23d4>Tag</h6></div></div> <hr data-v-042e23d4></div> <nav class="nav-links"><div class="nav-item"><a href="/vuepress-blog/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/categories/基础/" class="nav-link"><i class="iconfont undefined"></i>
  基础
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/categories/备忘/" class="nav-link"><i class="iconfont undefined"></i>
  备忘
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/categories/教程/" class="nav-link"><i class="iconfont undefined"></i>
  教程
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/categories/扩展/" class="nav-link"><i class="iconfont undefined"></i>
  扩展
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/categories/框架/" class="nav-link"><i class="iconfont undefined"></i>
  框架
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/categories/组件/" class="nav-link"><i class="iconfont undefined"></i>
  组件
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/categories/季度分享/" class="nav-link"><i class="iconfont undefined"></i>
  季度分享
</a></li></ul></div></div><div class="nav-item"><a href="/vuepress-blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/vuepress-blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时光轴
</a></div><div class="nav-item"><a href="https://github.com/ZooMze" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>2021-Q2 技术分享与探讨</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-blog/views/summary/2021-Q2.html#文件分批异步上传" class="sidebar-link">文件分批异步上传</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/views/summary/2021-Q2.html#文件的类型校验" class="sidebar-link">文件的类型校验</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/views/summary/2021-Q2.html#色码的转换函数" class="sidebar-link">色码的转换函数</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/views/summary/2021-Q2.html#将图片添加到canvas并输出为base64" class="sidebar-link">将图片添加到canvas并输出为base64</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/views/summary/2021-Q2.html#事件捕获-事件冒泡" class="sidebar-link">事件捕获, 事件冒泡</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-blog/views/summary/2021-Q2.html#target、currenttarget" class="sidebar-link">target、currentTarget</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/views/summary/2021-Q2.html#快问快答" class="sidebar-link">快问快答</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/views/summary/2021-Q2.html#阻止事件传播-和-阻止默认行为" class="sidebar-link">阻止事件传播 和 阻止默认行为</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/views/summary/2021-Q2.html#事件委托-冒泡的应用" class="sidebar-link">事件委托(冒泡的应用)</a></li></ul></li><li><a href="/vuepress-blog/views/summary/2021-Q2.html#百度地图-baidumap-gif-marker-icon-类" class="sidebar-link">百度地图 BaiduMap GIF Marker(Icon)类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-blog/views/summary/2021-Q2.html#_1-渲染并到目标元素" class="sidebar-link">1. 渲染并到目标元素</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/views/summary/2021-Q2.html#_2-添加用于区分的属性" class="sidebar-link">2. 添加用于区分的属性</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/views/summary/2021-Q2.html#_3-在生命周期中渲染" class="sidebar-link">3. 在生命周期中渲染</a></li></ul></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-19557b78><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>2021-Q2 技术分享与探讨</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>ZooMze</span>
            
          <span data-v-64685f0e>2018 - </span>
          2021
        </a></span></div></div> <div data-v-19557b78><main class="page"><div class="page-title" style="display:none;"><h1>2021-Q2 技术分享与探讨</h1> <hr> <div data-v-34ea29db><i class="iconfont reco-account" data-v-34ea29db><span data-v-34ea29db>ZooMze</span></i> <i class="iconfont reco-date" data-v-34ea29db><span data-v-34ea29db>2021-07-02</span></i> <i class="iconfont reco-eye" data-v-34ea29db><span id="/vuepress-blog/views/summary/2021-Q2.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-34ea29db><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="iconfont reco-tag tags" data-v-34ea29db><span class="tag-item" data-v-34ea29db>异步上传</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><h2 id="文件分批异步上传"><a href="#文件分批异步上传" class="header-anchor">#</a> 文件分批异步上传</h2> <p>假设每次上传文件至服务器就调用一次接口, 如果需要批量上传N个文件则需要调用N次接口, 并获取返回值:</p> <p>实现上述需求非常简单, 首先 <code>&lt;el-uploader&gt;</code> 中将文件选中, 然后在 <code>file-list</code> 中遍历调用上传接口即可实现批量上传</p> <p>这样会伴随一个问题: 这些文件何时<strong>全部上传完毕</strong>?</p> <p>解决的方式也很简单, 使用到了 <code>Promise.all()</code> 函数</p> <p><code>Promise.all()</code> 接受一个数组, 数组内为需要批量调用的 <code>Promise</code>, 全部调用完成后进入<code>.then()</code>回调, 此时执行上传全部完成的逻辑即可</p> <p>上述解决办法在文件数量在小批量范围内(数量级为百)是完全可行的, 然而新的问题是: 如果一次上传数量级为千甚至更多的文件会发生什么?</p> <p>请求将会发送失败, 错误信息: 'net::ERR_INSUFFICIENT_RESOURCES' (网络错误, 资源不足), 当然后台也有一定的并发限制等问题</p> <p>为了上传这几千个文件, 需要结合 <code>Promise.all()</code> 和 <strong>递归</strong> 来解决</p> <p>由于文件数量庞大, 所以操作逻辑设计为<strong>先选择好文件再统一点击上传, 而不是选择文件后立即自动上传, 减少服务器压力</strong></p> <p>上代码:</p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code>  <span class="token comment">// template d</span>

  <span class="token operator">&lt;</span>el<span class="token operator">-</span>upload
    <span class="token operator">:</span>file<span class="token operator">-</span>list<span class="token operator">=</span><span class="token string">&quot;fileList&quot;</span>
    <span class="token operator">:</span>action<span class="token operator">=</span><span class="token string">&quot;''&quot;</span>
    <span class="token operator">:</span>on<span class="token operator">-</span>change<span class="token operator">=</span><span class="token string">&quot;handleChange&quot;</span>
    <span class="token operator">:</span>on<span class="token operator">-</span>remove<span class="token operator">=</span><span class="token string">&quot;handleRemove&quot;</span>
    multiple
    <span class="token operator">:</span>limit<span class="token operator">=</span><span class="token string">&quot;5000&quot;</span>
    <span class="token operator">:</span>auto<span class="token operator">-</span>upload<span class="token operator">=</span><span class="token string">&quot;false&quot;</span>
  <span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>el<span class="token operator">-</span>button size<span class="token operator">=</span><span class="token string">&quot;small&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;primary&quot;</span><span class="token operator">&gt;</span>点击选择文件<span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>upload<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>el<span class="token operator">-</span>button v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;fileList.length &gt; 0&quot;</span> @click<span class="token operator">=</span><span class="token string">&quot;submitFiles&quot;</span><span class="token operator">&gt;</span>立即上传<span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>button<span class="token operator">&gt;</span>

  
  <span class="token comment">// 引入API</span>
  <span class="token keyword">import</span> <span class="token constant">API</span> <span class="token keyword">from</span> <span class="token string">'@/...'</span>
  
  <span class="token comment">// data</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      importForm<span class="token operator">:</span> <span class="token punctuation">{</span>
        files<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 实际在form表单中暂存的已上传的文件url数组</span>
      <span class="token punctuation">}</span>
      fileList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// upload组件中保存的file数组</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// methods</span>
  <span class="token comment">// 文件选择发生变化时调用, 使用钩子函数控制更新fileList, 同时也可以在此处理选择的文件</span>
  <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> fileList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这里以图片类型为例</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span>raw<span class="token punctuation">.</span>type <span class="token operator">!==</span> <span class="token string">'image/jpeg'</span> <span class="token operator">&amp;&amp;</span> file<span class="token punctuation">.</span>raw<span class="token punctuation">.</span>type <span class="token operator">!==</span> <span class="token string">'image/png'</span> <span class="token operator">&amp;&amp;</span> file<span class="token punctuation">.</span>raw<span class="token punctuation">.</span>type <span class="token operator">!==</span> <span class="token string">'image/bmp'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">warning</span><span class="token punctuation">(</span><span class="token string">'只支持 PNG/JPG/BMP 格式的图片'</span><span class="token punctuation">)</span>
      fileList<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 文件大小限制, 超出限制的图片将自动移除</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span>size <span class="token operator">&gt;</span> <span class="token number">5242880</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'上传的图片不能大于5MB'</span><span class="token punctuation">)</span>
      fileList<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 确认无误则更新fileList</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>fileList <span class="token operator">=</span> fileList
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">handleRemove</span><span class="token punctuation">(</span><span class="token parameter">file<span class="token punctuation">,</span> fileList</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>fileList <span class="token operator">=</span> fileList
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">submitFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">uploadBySteps</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 从第0批开始, 一次上传10个文件</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 分布上传函数(递归调用)</span>
  <span class="token comment">// step: 每一批次上传的文件个数</span>
  <span class="token comment">// index: 当前批次的序列, 表示当前加载第(index+1)批次的文件</span>
  <span class="token function">uploadBySteps</span><span class="token punctuation">(</span><span class="token parameter">step<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> currentLoadArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 当前批次的Promise数组</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> step<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>fileList<span class="token punctuation">[</span>step <span class="token operator">*</span> index <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> currentLoadArray<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">uploadSingleFile</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fileList<span class="token punctuation">[</span>step <span class="token operator">*</span> index <span class="token operator">+</span> i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>currentLoadArray<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fileList<span class="token punctuation">[</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> step<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 递归调用</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">uploadBySteps</span><span class="token punctuation">(</span>step<span class="token punctuation">,</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 上传单个文件, 此处的file为upload组件中直接获取的file对象</span>
  <span class="token function">uploadSingleFile</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'label'</span><span class="token punctuation">,</span> <span class="token string">'nice'</span><span class="token punctuation">)</span>
      formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span>raw<span class="token punctuation">)</span>
      <span class="token constant">API</span><span class="token punctuation">.</span><span class="token function">uploadFile</span><span class="token punctuation">(</span>formData<span class="token punctuation">)</span> <span class="token comment">// 这一步调用后台提供的上传接口即可</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// 调用成功即向importForm.files中添加url</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>importForm<span class="token punctuation">.</span>files<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            url<span class="token operator">:</span> res<span class="token punctuation">.</span>data
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token comment">// 当importForm.files中的url数量和fileList中一致时, 则上传全部完成了, 执行后续操作即可</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>importForm<span class="token punctuation">.</span>files<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fileList<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token constant">API</span><span class="token punctuation">.</span><span class="token function">filesInsert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>importForm<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>globalLoading<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">'全部上传成功, 数据已导入!'</span><span class="token punctuation">)</span>
                <span class="token comment">// 如果是在dialog中时, 最好将数据清空</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>importForm<span class="token punctuation">.</span>files <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>fileList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// 导入数据失败时也需要清空files</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>importForm<span class="token punctuation">.</span>files <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>fileList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br></div></div><h2 id="文件的类型校验"><a href="#文件的类型校验" class="header-anchor">#</a> 文件的类型校验</h2> <p>在此列举总结常见文件的类型方便查阅:</p> <table><thead><tr><th style="text-align:left;">文件类型</th> <th style="text-align:left;">后缀名</th> <th style="text-align:left;">编码</th></tr></thead> <tbody><tr><td style="text-align:left;">图片</td> <td style="text-align:left;">.jpg/.jpeg</td> <td style="text-align:left;"><code>image/jpeg</code></td></tr> <tr><td style="text-align:left;">图片</td> <td style="text-align:left;">.png</td> <td style="text-align:left;"><code>image/png</code></td></tr> <tr><td style="text-align:left;">图片</td> <td style="text-align:left;">.gif</td> <td style="text-align:left;"><code>image/gif</code></td></tr></tbody></table> <p>视频|.mp4|<code>video/mp4</code>
视频|.avi|<code>video/avi</code>
视频|.mpg|<code>video/mpeg</code>
视频|.wmv|<code>video/x-ms-wmv</code>
视频|.mov|<code>video/quicktime</code></p> <p>音频|.mp3|<code>audio/audio/mpeg</code>
音频|.aac|<code>audio/vnd.dlna.adts</code>
音频|.flac|<code>audio/flac</code>
音频|.m4a|<code>audio/audio/x-m4a</code>
音频|.wav|<code>audio/wav</code>
音频|.wma|<code>audio/x-ms-wma</code></p> <p>压缩文件|.zip|<code>application/x-zip-compressed</code>
压缩文件|.rar|``
压缩文件|.tar|<code>application/x-tar</code>
压缩文件|.tar.gz|<code>application/x-gzip</code></p> <h2 id="色码的转换函数"><a href="#色码的转换函数" class="header-anchor">#</a> 色码的转换函数</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 由十六进制色码转化为rgba格式的字符串</span>
<span class="token function">hexToRgba</span><span class="token punctuation">(</span><span class="token parameter">hex<span class="token punctuation">,</span> opacity <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token regex">/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/</span>
  <span class="token keyword">var</span> sColor <span class="token operator">=</span> hex<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>sColor <span class="token operator">&amp;&amp;</span> reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>sColor<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sColor<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> sColorNew <span class="token operator">=</span> <span class="token string">'#'</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sColorNew <span class="token operator">+=</span> sColor<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>sColor<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      sColor <span class="token operator">=</span> sColorNew
    <span class="token punctuation">}</span>
    <span class="token comment">//处理六位的颜色值</span>
    <span class="token keyword">var</span> sColorChange <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sColorChange<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'0x'</span> <span class="token operator">+</span> sColor<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rgba(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sColorChange<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>opacity<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> sColor
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">hexToRgba</span><span class="token punctuation">(</span><span class="token string">'#0f0'</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>    <span class="token comment">// &gt;&gt; rgba(0,255,0,0.5)</span>
<span class="token function">hexToRgba</span><span class="token punctuation">(</span><span class="token string">'#00ff00'</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token comment">// &gt;&gt; rgba(0,255,0,0.5)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="将图片添加到canvas并输出为base64"><a href="#将图片添加到canvas并输出为base64" class="header-anchor">#</a> 将图片添加到canvas并输出为base64</h2> <p>核心是直接创建一个canvas元素, 此元素不插入至文档流中, 方法结束后会被清理</p> <p>这里依赖了<a href="https://mirari.cc/2017/08/27/Vue%E5%9B%BE%E7%89%87%E6%B5%8F%E8%A7%88%E7%BB%84%E4%BB%B6v-viewer%EF%BC%8C%E6%94%AF%E6%8C%81%E6%97%8B%E8%BD%AC%E3%80%81%E7%BC%A9%E6%94%BE%E3%80%81%E7%BF%BB%E8%BD%AC%E7%AD%89%E6%93%8D%E4%BD%9C/" target="_blank" rel="noopener noreferrer">v-viewer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, 并且为了避免重复多次预渲染, 故采用API的方式调用, 由click事件触发</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">&quot;http://xxx.xxx.xxx&quot;</span> @click<span class="token operator">=</span><span class="token string">&quot;openViewer&quot;</span><span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// data为包含url以及其余需要绘制信息的数据</span>
<span class="token function">openViewer</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> self <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token keyword">const</span> loading <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$loading</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    lock<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    text<span class="token operator">:</span> <span class="token string">'图片渲染中...'</span><span class="token punctuation">,</span>
    spinner<span class="token operator">:</span> <span class="token string">'el-icon-loading'</span><span class="token punctuation">,</span>
    background<span class="token operator">:</span> <span class="token string">'rgba(0, 0, 0, 0.8)'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">var</span> url <span class="token operator">=</span> data<span class="token punctuation">.</span>url <span class="token comment">// 图片URL, 如果未配置代理需要完整地址</span>
  <span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  img<span class="token punctuation">.</span>crossOrigin <span class="token operator">=</span> <span class="token string">'Anonymous'</span> <span class="token comment">// 解决Canvas.toDataURL 图片跨域问题</span>
  img<span class="token punctuation">.</span>src <span class="token operator">=</span> url

  <span class="token comment">// 这里以绘制标注框为例</span>
  <span class="token comment">// data.rects = [{&quot;x&quot;: 300,&quot;y&quot;: 600,&quot;width&quot;: 100,&quot;height&quot;: 200}]</span>
  
  <span class="token keyword">function</span> <span class="token function">createCanvas</span> <span class="token punctuation">(</span><span class="token parameter">width<span class="token punctuation">,</span> height</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span>
    canvas<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> width<span class="token punctuation">)</span>
    canvas<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> height<span class="token punctuation">)</span>
    <span class="token keyword">const</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span>

    context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&quot;rgba(255,0,0,0.3)&quot;</span>
    context<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">&quot;rgb(255,0,0)&quot;</span>
    context<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">5</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>rects<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      data<span class="token punctuation">.</span>rects<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">rect</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span><span class="token function">strokeRect</span><span class="token punctuation">(</span>rect<span class="token punctuation">.</span>x<span class="token punctuation">,</span> rect<span class="token punctuation">.</span>y<span class="token punctuation">,</span> rect<span class="token punctuation">.</span>width<span class="token punctuation">,</span> rect<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
        context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span>rect<span class="token punctuation">.</span>x<span class="token punctuation">,</span> rect<span class="token punctuation">.</span>y<span class="token punctuation">,</span> rect<span class="token punctuation">.</span>width<span class="token punctuation">,</span> rect<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 导出</span>
    <span class="token keyword">const</span> base64Img <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">'image/jpg'</span><span class="token punctuation">)</span>
    <span class="token comment">// 如果使用`app.use`进行全局安装, 你就可以像这样直接调用`this.$viewerApi`</span>
    <span class="token keyword">const</span> $viewer <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token function">$viewerApi</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      images<span class="token operator">:</span> <span class="token punctuation">[</span>base64Img<span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    loading<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这里用path来读取img元素渲染后的内容</span>
    <span class="token function">createCanvas</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>path<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span> event<span class="token punctuation">.</span>path<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>height<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  img<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    loading<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'图片加载失败!'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><h2 id="事件捕获-事件冒泡"><a href="#事件捕获-事件冒泡" class="header-anchor">#</a> 事件捕获, 事件冒泡</h2> <p>在DOM事件绑定中, 通常会使用到<code>target</code>和<code>currentTarget</code>这两个属性, 区分这两个属性之前理一下JavaScript的事件流程</p> <ul><li><strong>捕获(capture)</strong> &gt; <strong>目标(target)</strong> &gt; <strong>冒泡(bubbling)</strong></li></ul> <p>历史上微软和网景为了是究竟是捕获还是冒泡争执不下, 后来W3C表示这别打了这俩种方式都支持</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">addEvenetListener</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">,</span> useCapture<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这第三个参数<code>useCapture</code>就是用来区分到底是在<strong>冒泡</strong>还是在<strong>捕获</strong>流程中触发事件函数
<code>true</code>: 捕获
<code>false</code>: 冒泡(默认)</p> <h3 id="target、currenttarget"><a href="#target、currenttarget" class="header-anchor">#</a> target、currentTarget</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;div&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>p id<span class="token operator">=</span><span class="token string">&quot;p&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>span id<span class="token operator">=</span><span class="token string">&quot;span&quot;</span><span class="token operator">&gt;</span>
      我是span
    <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
  <span class="token string">'click'</span><span class="token punctuation">,</span>
  <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>eventPhase<span class="token punctuation">,</span> event<span class="token punctuation">.</span>target<span class="token punctuation">,</span> event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token boolean">true</span>
<span class="token punctuation">)</span>

document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
  <span class="token string">'click'</span><span class="token punctuation">,</span>
  <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>eventPhase<span class="token punctuation">,</span> event<span class="token punctuation">.</span>target<span class="token punctuation">,</span> event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token boolean">true</span>
<span class="token punctuation">)</span>

document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
  <span class="token string">'click'</span><span class="token punctuation">,</span>
  <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>eventPhase<span class="token punctuation">,</span> event<span class="token punctuation">.</span>target<span class="token punctuation">,</span> event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token boolean">true</span>
<span class="token punctuation">)</span>

document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
  <span class="token string">'click'</span><span class="token punctuation">,</span>
  <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>eventPhase<span class="token punctuation">,</span> event<span class="token punctuation">.</span>target<span class="token punctuation">,</span> event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token boolean">false</span>
<span class="token punctuation">)</span>

document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
  <span class="token string">'click'</span><span class="token punctuation">,</span>
  <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>eventPhase<span class="token punctuation">,</span> event<span class="token punctuation">.</span>target<span class="token punctuation">,</span> event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token boolean">false</span>
<span class="token punctuation">)</span>

document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
  <span class="token string">'click'</span><span class="token punctuation">,</span>
  <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>eventPhase<span class="token punctuation">,</span> event<span class="token punctuation">.</span>target<span class="token punctuation">,</span> event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token boolean">false</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>点击 <strong>我是span</strong> 元素, 控制台输出如下</p> <p><img src="/vuepress-blog/assets/img/event-console.54d2eea6.png" alt="图片"></p> <p>这里的<code>eventPhase</code>属性值就说明了当前事件处理程序的阶段</p> <ul><li>1: <strong>捕获</strong>阶段</li> <li>2: <strong>目标</strong>阶段</li> <li>3: <strong>冒泡</strong>阶段</li></ul> <p>可以看到事件实际上的顺序就是最开始提到的顺序:</p> <ol><li>div 1 (捕获)</li> <li>p 1 (捕获)</li> <li>span 2 (目标)</li> <li>span 2 (目标)</li> <li>p 3 (冒泡)</li> <li>div 3 (冒泡)</li></ol> <div class="custom-block tip"><ul><li>目标过程其实执行了两遍, <strong>捕获的结尾</strong>和<strong>冒泡的开始</strong>都是目标过程</li></ul></div> <p>所以<code>target</code>是事件真实触发的元素, 而<code>currentTarget</code>是事件流进行过程中的当前元素</p> <p>再换成更常见的vue写法, 这里就不再输出<code>eventPhase</code>属性了:</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>div<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleDivClicked<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>p<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handlePClicked<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>span<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleSpanClicked<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      我是span
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>methods<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token function">handleDivClicked</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>target<span class="token punctuation">,</span> event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">handlePClicked</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>target<span class="token punctuation">,</span> event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">handleSpanClicked</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>target<span class="token punctuation">,</span> event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>点击 <strong>我是span</strong>, 然后再观察控制台输出:</p> <p><img src="data:image/png;base64,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" alt="图片"></p> <ul><li>由于事件默认是按冒泡的方式, 所以先由触发元素本身响应, 再向上冒泡依次响应</li> <li>因为<code>target</code>是真实触发的元素, 所以三个<code>target</code>全部输出为<code>span</code>元素;</li> <li><code>handleSpanClicked</code>事件由于是其本身触发, <code>currentTarget</code>与<code>target</code>一致;</li> <li><code>p</code>和<code>div</code>都是冒泡触发, 他们并不是本身触发了事件, 所以这两个事件的<code>target</code>都是真正触发的源头<code>span</code>元素, 而<code>currentTarget</code>才是这两个元素本身</li></ul> <h3 id="快问快答"><a href="#快问快答" class="header-anchor">#</a> 快问快答</h3> <p>思考下方几种情况下, 点击 <code>我是高级span</code> 的三个事件的输出以及顺序</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>div<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click.capture</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleDivClicked<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>p<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handlePClicked<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>span<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click.stop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleSpanClicked<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      我是高级span
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><details class="custom-block details"><summary>结果</summary> <ol><li>div</li> <li>span</li></ol></details> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>div<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click.self</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleDivClicked<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>p<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click.capture</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handlePClicked<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>span<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleSpanClicked<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      我是高级span
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><details class="custom-block details"><summary>结果</summary> <ol><li>p</li> <li>span</li></ol></details> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>div<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click.capture</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleDivClicked<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>p<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click.stop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handlePClicked<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>span<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click.capture</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleSpanClicked<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      我是高级span
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><details class="custom-block details"><summary>结果</summary> <ol><li>div</li> <li>span</li> <li>p</li></ol></details> <h3 id="阻止事件传播-和-阻止默认行为"><a href="#阻止事件传播-和-阻止默认行为" class="header-anchor">#</a> 阻止事件传播 和 阻止默认行为</h3> <p>当需要停止冒泡时, 除了vue中的<code>.stop</code>事件修饰符, 在<code>addEventListener(event, function)</code>中最后调用<code>event.stopPropagation()</code>, 这样函数就不会冒泡或者被捕获了</p> <p>同样, 有的元素会有默认行为, 例如点击a标签会跳转, 拖拽图片可以在新标签页中打开它, <code>&lt;input type=submit /&gt;</code>会自动提交表单等, 当需要阻止默认行为时, 调用event内的方法<code>event.preventDefault()</code></p> <h3 id="事件委托-冒泡的应用"><a href="#事件委托-冒泡的应用" class="header-anchor">#</a> 事件委托(冒泡的应用)</h3> <p>如果需要给多个元素绑定事件, 或许会采用这种方式:</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ul<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>li<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>li 1&lt;/&gt;
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>li<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>li 2&lt;/&gt;
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>li<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>li 3&lt;/&gt;
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>li<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>li 4&lt;/&gt;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> lis <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span>
lis<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">li</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  li<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这样会重复添加很多重复的事件, 利用事件冒泡的特性, 可以委托给ul元素, 让ul通过冒泡来执行事件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">)</span>
ul<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>事件委托的另一个优点是如果新加入的子元素, 无需重复添加事件, 同样能被捕获冒泡响应到</li></ul> <h2 id="百度地图-baidumap-gif-marker-icon-类"><a href="#百度地图-baidumap-gif-marker-icon-类" class="header-anchor">#</a> 百度地图 BaiduMap GIF Marker(Icon)类</h2> <p><a href="https://mapopen-pub-jsapi.bj.bcebos.com/jsapi/reference/jsapi_reference_3_0.html#a3b2" target="_blank" rel="noopener noreferrer">百度地图JavaScript API - Marker类<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://mapopen-pub-jsapi.bj.bcebos.com/jsapi/reference/jsapi_reference_3_0.html#a3b5" target="_blank" rel="noopener noreferrer">百度地图JavaScript API - Icon类<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Baidu地图可以根据经纬度坐标( <code>lat</code>(Latitude纬度<code>0 ~ 90</code>), <code>lng</code>(Longtitude经度<code>0 ~ 180</code>) )生生成 <code>Marker</code> 类放置在地图上, 但是百度实现方式是将用到的图片资源压缩成了一张sprite图(在设置offset属性如果值不合适时会显示出其他图片资源), 这就导致了 <code>Icon</code> 类并<strong>不能直接设置动态GIF图</strong></p> <p>实现方法: 给已经生成的Marker元素追加样式CSS</p> <h3 id="_1-渲染并到目标元素"><a href="#_1-渲染并到目标元素" class="header-anchor">#</a> 1. 渲染并到目标元素</h3> <p>首先先创建一个Marker元素并渲染在Map上</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 渲染地图部分略(BMapGL)...</span>

<span class="token keyword">const</span> markerPoint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BMapGL<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token number">118.888888</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token number">28.888888</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 这里的代码都是从项目中复制的</span>
<span class="token keyword">const</span> myIcon <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BMapGL<span class="token punctuation">.</span>Icon</span><span class="token punctuation">(</span>iconUrl<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BMapGL<span class="token punctuation">.</span>Size</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  anchor<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">BMapGL<span class="token punctuation">.</span>Size</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  imageOffset<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">BMapGL<span class="token punctuation">.</span>Size</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  imageSize<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">BMapGL<span class="token punctuation">.</span>Size</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> marker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BMapGL<span class="token punctuation">.</span>Marker</span><span class="token punctuation">(</span>markerPoint<span class="token punctuation">,</span> <span class="token punctuation">{</span> icon<span class="token operator">:</span> myIcon <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
marker<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>mapObj<span class="token punctuation">.</span><span class="token function">addOverlay</span><span class="token punctuation">(</span>marker<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>这样渲染出来的Marker DOM就成功显示出来了, 但是还有点问题, 就是所有的Marker对象元素都是同样的<code>class=&quot;BMap_Marker&quot;</code>, 查阅了一下API, 没有给其Marker单独赋值class的方法, 好在天无绝人之路, 这个Marker可以赋值一个title属性:</p> <h3 id="_2-添加用于区分的属性"><a href="#_2-添加用于区分的属性" class="header-anchor">#</a> 2. 添加用于区分的属性</h3> <p><img src="/vuepress-blog/assets/img/map-marker.82d73324.png" alt="mapMarker"></p> <p>那就只有在这个<code>title</code>属性上做文章, 给需要放上gif的Marker的<code>title</code>中添加一些特殊的标志性文本: <em>&quot;(轻度)&quot;</em>, <em>&quot;(中度)&quot;</em>, <em>&quot;(重度)&quot;</em> 这种<strong>不会跟Marker本身代表的含义出现重叠的文字</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// ...</span>
<span class="token keyword">let</span> nameSuffix <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>untreatedCount <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>untreatedCount <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mapForm<span class="token punctuation">.</span>lowLimit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    nameSuffix <span class="token operator">=</span> <span class="token string">&quot;(轻度)&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
    data<span class="token punctuation">.</span>untreatedCount <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mapForm<span class="token punctuation">.</span>lowLimit <span class="token operator">&amp;&amp;</span>
    data<span class="token punctuation">.</span>untreatedCount <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mapForm<span class="token punctuation">.</span>highLimit
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    nameSuffix <span class="token operator">=</span> <span class="token string">&quot;(中度)&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    nameSuffix <span class="token operator">=</span> <span class="token string">&quot;(重度)&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
marker<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>name <span class="token operator">+</span> nameSuffix<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_3-在生命周期中渲染"><a href="#_3-在生命周期中渲染" class="header-anchor">#</a> 3. 在生命周期中渲染</h3> <p>然后的事情就是根据这个程度来执行不同的渲染逻辑</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 在marker添加完成后的回调中重新设置样式</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>mapObj<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;tilesloaded&quot;</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mapObj<span class="token punctuation">.</span><span class="token function">getOverlays</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mapObj<span class="token punctuation">.</span><span class="token function">getOverlays</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">&quot;BMap_Marker&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>title<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;轻度&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        item<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundImage <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">url(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>iconGreen<span class="token punctuation">.</span>base64<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        item<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundSize <span class="token operator">=</span> <span class="token string">&quot;100% 100%&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>title<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;中度&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        item<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundImage <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">url(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>iconYellow<span class="token punctuation">.</span>base64<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        item<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundSize <span class="token operator">=</span> <span class="token string">&quot;100% 100%&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>title<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;重度&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        item<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundImage <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">url(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>iconRed<span class="token punctuation">.</span>base64<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        item<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundSize <span class="token operator">=</span> <span class="token string">&quot;100% 100%&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><s>后话: 高德地图, 腾讯地图直接可以使用GIF...</s></p></div> <footer class="page-edit" style="display:none;"><!----> <!----></footer> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:65px;bottom:0px;width:130px;height:290px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2d_canvas" width="130" height="290" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:130px;height:290px;"></canvas></div></div></div>
    <script src="/vuepress-blog/assets/js/app.08ec8abf.js" defer></script><script src="/vuepress-blog/assets/js/4.98f06f74.js" defer></script><script src="/vuepress-blog/assets/js/1.f7bebc45.js" defer></script><script src="/vuepress-blog/assets/js/15.c487e23b.js" defer></script>
  </body>
</html>
